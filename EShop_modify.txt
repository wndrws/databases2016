CREATE GENERATOR Seq_catID;
CREATE GENERATOR Seq_specID;

CREATE TABLE CATEGORIES (
    ID                  integer         NOT NULL PRIMARY KEY,
    Name                varchar(64)     NOT NULL
);

SET TERM ^;
CREATE TRIGGER set_catID BEFORE INSERT ON CATEGORIES
AS
BEGIN
    IF(NEW.ID IS NULL) THEN
        NEW.ID = GEN_ID(Seq_catID, 1);
END^
SET TERM ;^

INSERT INTO CATEGORIES (Name) SELECT DISTINCT Category FROM CATEGORIES_ARRANGEMENT ORDER BY 1 ASC;

CREATE TABLE SPECIFICATIONS (
    ID                  integer         NOT NULL PRIMARY KEY,
    Name                varchar(64)     NOT NULL
);

SET TERM ^;
CREATE TRIGGER set_specID BEFORE INSERT ON SPECIFICATIONS
AS
BEGIN
    IF(NEW.ID IS NULL) THEN
        NEW.ID = GEN_ID(Seq_specID, 1);
END^
SET TERM ;^

INSERT INTO SPECIFICATIONS (Name)
SELECT * FROM (select RDB$FIELD_NAME as Spec from RDB$RELATION_FIELDS where RDB$RELATION_NAME = 'CAT_SSD') WHERE Spec <> 'ARTICLE'
UNION
SELECT * FROM (select RDB$FIELD_NAME as Spec from RDB$RELATION_FIELDS where RDB$RELATION_NAME = 'CAT_HDD') WHERE Spec <> 'ARTICLE'
UNION
SELECT * FROM (select RDB$FIELD_NAME as Spec from RDB$RELATION_FIELDS where RDB$RELATION_NAME = 'CAT_STORAGE') WHERE Spec <> 'ARTICLE'
ORDER BY 1 ASC;

COMMIT;

CREATE TABLE CATSPEC_DISTRIBUTION (
    catID               integer         NOT NULL REFERENCES CATEGORIES (ID),
    specID              integer         NOT NULL REFERENCES SPECIFICATIONS(ID),
    CONSTRAINT pk_CATSPEC_DISTRIBUTION PRIMARY KEY ( catID, specID )
);

INSERT INTO CATSPEC_DISTRIBUTION VALUES (1, 5);
INSERT INTO CATSPEC_DISTRIBUTION VALUES (2, 3);
INSERT INTO CATSPEC_DISTRIBUTION VALUES (2, 4);
INSERT INTO CATSPEC_DISTRIBUTION VALUES (3, 1);
INSERT INTO CATSPEC_DISTRIBUTION VALUES (3, 2);

COMMIT;

CREATE TABLE CAT_ARRANGEMENT (
    article             integer         NOT NULL REFERENCES GOODS (Article),
    catID               integer         NOT NULL REFERENCES CATEGORIES (ID),
    CONSTRAINT pk_CAT_ARRANGEMENT PRIMARY KEY ( article, catID )
);

INSERT INTO CAT_ARRANGEMENT VALUES (9, 3);
INSERT INTO CAT_ARRANGEMENT VALUES (9, 2);
INSERT INTO CAT_ARRANGEMENT VALUES (10, 3);
INSERT INTO CAT_ARRANGEMENT VALUES (10, 2);
INSERT INTO CAT_ARRANGEMENT VALUES (11, 3);
INSERT INTO CAT_ARRANGEMENT VALUES (11, 2);
INSERT INTO CAT_ARRANGEMENT VALUES (12, 3);
INSERT INTO CAT_ARRANGEMENT VALUES (12, 1);

COMMIT;

CREATE TABLE SPEC_ARRANGEMENT (
    article             integer         NOT NULL REFERENCES GOODS (Article),
    specID              integer         NOT NULL REFERENCES SPECIFICATIONS(ID),
    Spec_value          varchar(256)    ,
    CONSTRAINT pk_SPEC_ARRANGEMENT PRIMARY KEY ( article, specID )
);

INSERT INTO SPEC_ARRANGEMENT VALUES (9, 1, '120 Gb');
INSERT INTO SPEC_ARRANGEMENT VALUES (9, 2, 'SATA');
INSERT INTO SPEC_ARRANGEMENT VALUES (9, 3, NULL);
INSERT INTO SPEC_ARRANGEMENT VALUES (9, 4, '88000');
INSERT INTO SPEC_ARRANGEMENT VALUES (10, 1, '250 Gb');
INSERT INTO SPEC_ARRANGEMENT VALUES (10, 2, 'SATA');
INSERT INTO SPEC_ARRANGEMENT VALUES (10, 3, NULL);
INSERT INTO SPEC_ARRANGEMENT VALUES (10, 4, '88000');
INSERT INTO SPEC_ARRANGEMENT VALUES (11, 1, '250 Gb');
INSERT INTO SPEC_ARRANGEMENT VALUES (11, 2, 'M.2');
INSERT INTO SPEC_ARRANGEMENT VALUES (11, 3, NULL);
INSERT INTO SPEC_ARRANGEMENT VALUES (11, 4, '89000');
INSERT INTO SPEC_ARRANGEMENT VALUES (12, 1, '2000 Gb');
INSERT INTO SPEC_ARRANGEMENT VALUES (12, 2, 'USB 3.0');
INSERT INTO SPEC_ARRANGEMENT VALUES (12, 5, '7200');

COMMIT;

DROP TABLE CATEGORIES_ARRANGEMENT;
DROP TABLE CAT_STORAGE;
DROP TABLE CAT_SSD;
DROP TABLE CAT_HDD;

COMMIT;